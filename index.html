<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="tarot-images.js"></script>
    <link rel="stylesheet" href="style.css">
    <title>Authentic Tarot</title>
</head>
<body>
    <h1 id="header">Tap and drag or click and drag to shuffle!</h1>
    <div class="container" id="pulled"></div>
    <div class="container" id="container"></div>
</body>
<script>
    var tarotDeck = JSON.parse(tarotImages);
    var numCards = 78;
    var index = 0;
    var isDragging =false;
    const header = document.getElementById("header");
    const pulled = document.getElementById("pulled");
    const container = document.getElementById("container");
    const startTime = Date.now();

    function getCardIndex(x, y) {
        var endTime = Date.now();
        var rand = x + y + endTime - startTime;
        var cardIndex = Math.floor(rand % numCards);
        var cardName = tarotDeck.cards[cardIndex].name;
        var cardImage = tarotDeck.cards[cardIndex].img;
        var card = document.createElement("div");
        card.setAttribute("class", "card");
        card.setAttribute("id", index);
        card.setAttribute("data-index", cardIndex);
        card.setAttribute("data-name", cardName)
        card.setAttribute("image-path", cardImage);
        card.setAttribute("onclick", "reveal(" + index  + ")");
        container.appendChild(card);
        tarotDeck.cards.splice(cardIndex, 1);
        numCards--;
        index++;
    }

    function showCards() {
        container.style.setProperty("display", "block");
        pulled.style.setProperty("display", "block");
        header.innerText = "Tap/click a card to reveal it";
    };

    function reveal(index) {
        var card = document.getElementById(index);
        card.title = card.getAttribute("data-name");
        var imagePath = card.getAttribute("image-path");
        card.style.setProperty("background-image", `url(\"cards/${imagePath}\")`);
        var clone=card.cloneNode(true);
        clone.style.setProperty("margin", "10px 10px 10px 10px");
        clone.removeAttribute("onclick");
        pulled.appendChild(clone);
        card.style.setProperty("visibility", "hidden");
    }

    function shuffle(x, y) {
        if (numCards > 0) {
            getCardIndex(x, y);
            percentDone = Math.floor((100 - (numCards / 78 * 100)));
            header.innerText = percentDone + "% done"
        }
        else {
            showCards();
            document.removeEventListener('click', shuffle);
        }
    }

    function getXYmouse(e) {
        var x = e.clientX;
        var y = e.clientY;
        shuffle(x, y);
    }

    function getXYtouch(e) {
        var x = e.touches[0].clientX;
        var y = e.touches[0].clientY;
        shuffle(x, y);
    }

    document.addEventListener('click', getXYmouse);

    function handleStart(e) {
        isDragging = true;
    }

    function handleMove(e) {
        if (isDragging)
            getXYmouse(e);
    }

    function handleEnd() {
        isDragging = false;
    }

    // Desktop events
    document.addEventListener('mousedown', handleStart);
    document.addEventListener('mousemove', handleMove);
    document.addEventListener('mouseup', handleEnd);

    // Mobile events
    document.addEventListener('touchmove', getXYtouch);
</script>
</html>
